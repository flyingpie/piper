@using Piper.Core
@using Piper.Core.Data

<RadzenStack Orientation="Orientation.Vertical">

	<RadzenTextBox @bind-Value="SearchTerm" />

	<RadzenDataGrid

		TItem="PpRecord"

		@ref="_grid"

		AllowAlternatingRows="true"
		AllowColumnResize="true"
		AllowFiltering="true"
		AllowPaging="true"
		AllowSorting="true"
		FilterMode="FilterMode.SimpleWithMenu"
		LogicalFilterOperator="LogicalFilterOperator.Or"
		PagerHorizontalAlign="HorizontalAlign.Left"
		PageSize="15"
		SelectionMode="DataGridSelectionMode.Single"
		ShowPagingSummary="true"

		Data="@Records"
		Count="@RecordCount"
		LoadData="@LoadDataAsync"

	>
		<Columns>

			@foreach (var field in Columns)
			{
				<RadzenDataGridColumn
					TItem="PpRecord"
					Title="@field.Name"
					Width="@GetWidth(field)"
					TextAlign="@(GetAlign(field))"
				>
					<Template Context="item">
						@switch (field.PpDataType)
						{
							case PpDataType.PpDateTime:
								@(item.Fields.TryGetValue(field.Name, out var v1) ? v1.ValueAsDateTime.Value.ToString("s") : null)
								break;

							default:
								@(item.Fields.TryGetValue(field.Name, out var v) ? v : null)
								break;
						}
					</Template>
				</RadzenDataGridColumn>
			}
		</Columns>
	</RadzenDataGrid>

</RadzenStack>